@using CareSync.Application.DTOs.Doctors
@using CareSync.Application.DTOs.Patients
@using System.Linq
@using Microsoft.AspNetCore.Components.Forms

<div class="row">
    <div class="col-md-6">
        <div class="mb-3">
            <label class="form-label">Patient *</label>
            <InputSelect @bind-Value="Model.PatientIdString" class="form-select">
                <option value="">Select patient</option>
                @if (Patients != null)
                {
                    foreach (var patient in Patients.OrderBy(p => p.DisplayName))
                    {
                        <option value="@patient.Id.ToString()">@patient.DisplayName</option>
                    }
                }
            </InputSelect>
            <ValidationMessage For="@(() => Model.PatientIdString)" />
        </div>
    </div>
    <div class="col-md-6">
        <div class="mb-3">
            <label class="form-label">Doctor *</label>
            <InputSelect @bind-Value="Model.DoctorIdString" class="form-select">
                <option value="">Select doctor</option>
                @if (Doctors != null)
                {
                    foreach (var doctor in Doctors.OrderBy(d => d.DisplayName))
                    {
                        <option value="@doctor.Id.ToString()">Dr. @doctor.DisplayName</option>
                    }
                }
            </InputSelect>
            <ValidationMessage For="@(() => Model.DoctorIdString)" />
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="mb-3">
            <label class="form-label">Appointment Date & Time *</label>
            <InputDate Type="InputDateType.DateTimeLocal" @bind-Value="Model.StartDateTime" class="form-control" />
            <ValidationMessage For="@(() => Model.StartDateTime)" />
        </div>
    </div>
    <div class="col-md-6">
        <div class="mb-3">
            <label class="form-label">Duration (minutes) *</label>
            <InputNumber @bind-Value="Model.DurationMinutes" class="form-control" />
            <ValidationMessage For="@(() => Model.DurationMinutes)" />
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
            <div class="mb-3">
                <label class="form-label">Appointment Type *</label>
                <InputSelect @bind-Value="Model.AppointmentType" class="form-select">
                    @if (AppointmentTypes != null)
                    {
                        <option value="">Select appointment type</option>
                        @foreach (var t in AppointmentTypes)
                        {
                            <option value="@t">@t</option>
                        }
                    }
                    else
                    {
                        <!-- fallback options -->
                        <option value="Consultation">Consultation</option>
                        <option value="Follow-up">Follow-up</option>
                        <option value="Teleconsult">Teleconsult</option>
                        <option value="Physical Exam">Physical Exam</option>
                        <option value="Procedure">Procedure</option>
                        <option value="Vaccination">Vaccination</option>
                    }
                </InputSelect>
                <ValidationMessage For="@(() => Model.AppointmentType)" />
            </div>
    </div>
    <div class="col-md-6">
        <div class="mb-3">
            <label class="form-label">Reason for Visit</label>
            <InputText @bind-Value="Model.ReasonForVisit" class="form-control" placeholder="Enter reason" />
            <ValidationMessage For="@(() => Model.ReasonForVisit)" />
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="mb-3">
            <label class="form-label">Notes</label>
            <InputTextArea @bind-Value="Model.Notes" class="form-control" rows="3" placeholder="Additional notes" />
            <ValidationMessage For="@(() => Model.Notes)" />
        </div>
    </div>
</div>

@code {
    [Parameter] public AppointmentFormDto Model { get; set; } = null!;
    [Parameter] public IEnumerable<PatientDto>? Patients { get; set; }
    [Parameter] public IEnumerable<DoctorDto>? Doctors { get; set; }
    [Parameter] public IEnumerable<string>? AppointmentTypes { get; set; }
}
